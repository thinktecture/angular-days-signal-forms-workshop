<mat-card class="form-container">
  <mat-card-header>
    <mat-card-title>Reactive Form - Registration</mat-card-title>
    <mat-card-subtitle>
      This is a classic Angular Reactive Form with nested objects, FormArray, and custom validators.
      Your task: Convert this to the new Signal Forms API.
    </mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()">
      <!-- Personal Info Section -->
      <section class="form-section">
        <h3>Personal Information</h3>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>First Name</mat-label>
            <input matInput type="text" formControlName="firstName" />
            @if (hasError('firstName')) {
              <mat-error>{{ getErrorMessage('firstName') }}</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Last Name</mat-label>
            <input matInput type="text" formControlName="lastName" />
            @if (hasError('lastName')) {
              <mat-error>{{ getErrorMessage('lastName') }}</mat-error>
            }
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email</mat-label>
          <input matInput type="email" formControlName="email" />
          @if (hasError('email')) {
            <mat-error>{{ getErrorMessage('email') }}</mat-error>
          }
        </mat-form-field>
      </section>

      <!-- Password Section -->
      <section class="form-section">
        <h3>Password</h3>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Password</mat-label>
          <input matInput type="password" formControlName="password" />
          @if (hasError('password')) {
            <mat-error>{{ getErrorMessage('password') }}</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirm Password</mat-label>
          <input matInput type="password" formControlName="confirmPassword" />
          @if (hasError('confirmPassword')) {
            <mat-error>{{ getErrorMessage('confirmPassword') }}</mat-error>
          }
          @if (registrationForm.errors?.['passwordMismatch'] && registrationForm.get('confirmPassword')?.touched) {
            <mat-error>Passwords do not match</mat-error>
          }
        </mat-form-field>
      </section>

      <!-- Address Section (Nested Object) -->
      <section class="form-section" formGroupName="address">
        <h3>Address</h3>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Street</mat-label>
          <input matInput type="text" formControlName="street" />
          @if (hasError('address.street')) {
            <mat-error>{{ getErrorMessage('address.street') }}</mat-error>
          }
        </mat-form-field>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Postal Code</mat-label>
            <input matInput type="text" formControlName="postalCode" placeholder="12345" />
            @if (hasError('address.postalCode')) {
              <mat-error>{{ getErrorMessage('address.postalCode') }}</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>City</mat-label>
            <input matInput type="text" formControlName="city" />
            @if (hasError('address.city')) {
              <mat-error>{{ getErrorMessage('address.city') }}</mat-error>
            }
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Country</mat-label>
          <mat-select formControlName="country">
            <mat-option value="">Select a country...</mat-option>
            @for (country of countries; track country) {
              <mat-option [value]="country">{{ country }}</mat-option>
            }
          </mat-select>
          @if (hasError('address.country')) {
            <mat-error>{{ getErrorMessage('address.country') }}</mat-error>
          }
        </mat-form-field>
      </section>

      <!-- Phone Numbers Section (FormArray) -->
      <section class="form-section">
        <h3>Phone Numbers</h3>

        @for (phone of phoneNumbers.controls; track $index; let i = $index) {
          <div class="phone-entry" [formGroupName]="'phoneNumbers'">
            <div [formGroupName]="i" class="phone-row">
              <mat-form-field appearance="outline" class="type-field">
                <mat-label>Type</mat-label>
                <mat-select formControlName="type">
                  @for (type of phoneTypes; track type) {
                    <mat-option [value]="type">{{ type }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="number-field">
                <mat-label>Number</mat-label>
                <input matInput type="tel" formControlName="number" placeholder="+49 123 456789" />
                @if (hasError('phoneNumbers.' + i + '.number')) {
                  <mat-error>{{ getErrorMessage('phoneNumbers.' + i + '.number') }}</mat-error>
                }
              </mat-form-field>

              <button
                mat-icon-button
                color="warn"
                type="button"
                (click)="removePhoneNumber(i)"
                [disabled]="phoneNumbers.length === 1"
                aria-label="Remove phone number"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        }

        <button mat-stroked-button color="primary" type="button" (click)="addPhoneNumber()">
          <mat-icon>add</mat-icon>
          Add Phone Number
        </button>
      </section>

      <!-- Terms -->
      <section class="form-section">
        <mat-checkbox formControlName="acceptTerms" color="primary">
          I accept the terms and conditions *
        </mat-checkbox>
        @if (hasError('acceptTerms')) {
          <mat-error class="checkbox-error">You must accept the terms</mat-error>
        }
      </section>

      <!-- Form Actions -->
      <div class="form-actions">
        <button mat-flat-button color="primary" type="submit" [disabled]="registrationForm.invalid">
          Register
        </button>
        <button mat-stroked-button type="button" (click)="onReset()">
          Reset
        </button>
      </div>

      <!-- Debug Info -->
      <mat-card class="debug-info" appearance="outlined">
        <mat-card-header>
          <mat-card-title>Form State (Debug)</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p><strong>Valid:</strong> {{ registrationForm.valid }}</p>
          <p><strong>Dirty:</strong> {{ registrationForm.dirty }}</p>
          <p><strong>Touched:</strong> {{ registrationForm.touched }}</p>
          <h4>Form Value</h4>
          <pre>{{ registrationForm.value | json }}</pre>
          @if (registrationForm.errors) {
            <h4>Form-Level Errors</h4>
            <pre>{{ registrationForm.errors | json }}</pre>
          }
        </mat-card-content>
      </mat-card>
    </form>
  </mat-card-content>
</mat-card>

@if (submitted) {
  <mat-card class="success-message">
    <mat-card-header>
      <mat-card-title>Registration Successful!</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <pre>{{ submittedData | json }}</pre>
    </mat-card-content>
  </mat-card>
}
